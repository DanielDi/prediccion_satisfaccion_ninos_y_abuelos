---
title: ''
author: ''
date: ''
output:
  html_document:
    df_print: paged
lang: es
---
\begin{titlepage}
\centering
{\scshape\Huge Informe Técnico \par}
{\scshape\Huge  Satisfacción de Niños y Abuelos \par}
\vspace{2cm}
{\Large Por: \par}
{\Large Daniel Espinal Mosquera\par}
{\Large Juan Sebastián Falcón\par}
{\Large Juan F. Peña Tamayo\par}
{\Large Brayan M. Ortiz Fajardo\par}
{\Large Thalea Marina Hesse\par}
\vfill
\vspace{0.5cm}

```{r echo=FALSE, out.width = "300px", out.height="150px",fig.align='center'}
knitr::include_graphics("Imagenes/LOGO.png")

```
\vfill
\vspace{0.5cm}
{\bfseries\LARGE Universidad Nacional de Colombia \par Sede Medellín \par}
\vspace{1cm}
\end{titlepage}

```{r setup, include=FALSE, echo=FALSE}
library(ggplot2)
library(dplyr)
library(hrbrthemes)
library(readxl)
library(dplyr)
require(ggplot2)
require(corrplot)
library(reshape2)
require(kableExtra)
require(ggcorrplot)
require(magrittr)
knitr::opts_chunk$set(echo = TRUE)
```

# Introducción 

La satisfacción de la vida y la felicidad varía entre países \cite{b7} y juegan un papel importante en el desarrollo de un país. Sin embargo, no se logró determinar documentación o estudios relacionados sobre cómo se pueden predecir estos factores en Colombia dados unos parámetros. Por tal motivo, se propone el plantemiento, desarrollo, análisis y posterior productización de un modelo con el cual se busca predecir la satisfacción de niños y abuelos. Para lograr esto, se toma como base una encuesta realizada por el DANE en el 2020: Colombia - Encuesta Nacional de Calidad de Vida - ECV 2020. Esta investigación, según el DANE "Busca cuantificar y caracterizar las condiciones socioeconómicas de los hogares colombianos, con el fin de obtener la información necesaria para la actualización de indicadores sociales a nivel de viviendas, hogares y personas, y para la definición de políticas que permitan diseñar y ejecutar planes sociales." (Metodologia ECV, 2009, p.17)   
La estructura del estudio se planteó de la siguiente manera: se hizo una búsqueda exhaustiva sobre documentación para determinar cuáles de las variables que se tienen afectan de manera significativa la satisfacción. Después se planteó un modelo general, sin embargo al revisar las correlaciones entre las variables predictoras se dicidió partir ese modelo general en tres sub-modelos: satisfacción de salud, seguridad y trabajo. Para cada cada uno de estos también se realizó la búsqueda de documentación al respecto. Adicionalmente, se creó una página web para poder interactuar con los modelos. Finalmente, se obtuvieron los resultados y plantearon las conclusiones. 

# Justificación 
## Niños

En primera instancia se planteó tomar a los niños en dos grupos, uno como aquellos pertenecientes a la primera infancia (0 a 5 años) y otro con aquellos niños con edad entre 6 y 12 años. Sin embargo, luego se decidio que tomariamos como niño la definicion integrada en el codigo de infancia y adolesencia, donde se expone que "Para todos los efectos de esta ley son sujetos titulares de derechos todas las personas menores de 18 años. Sin perjuicio de lo establecido en el artículo 34 del Código Civil, se entiende por niño o niña las personas entre los 0 y los 12 años, y por adolescente las personas entre 12 y 18 años de edad"(Articulo 3).

Una vez adoptada esta definicion se analizo cuantas observaciones de la ECV cumplian esta condicion, resultando en un total de 56128 niños.


## Abuelos

Para los abuelos, al igual que con los niños, se penso inicialmente en tomar un rango de edad que tomara la definicion popular de este colectivo, los adultos de la tercera edad (mayores de 60 años). Sin embargo, luego planteamos que debiamos tener en cuenta cual es la definicion literal de abuelo,  y mediante un sistema de grafos logramos determinar el numero de hombres y mujeres que tenian un nieto. Filtrandolos por su rango edad.

\begin{table}[H]
\begin{center}
\begin{tabular}{|l|l|}
\hline
Mayor a 60 años & 1467 \\ \hline
Menor a 60 años & 1049 \\ \hline
\end{tabular}
\end{center}
\end{table}

Se observa que con la definicion inicial estabamos omitiendo un total de 1049 observaciones, ademas, se observa que los abuelos resgitrados en la base de datos son relativamente pocos pues solo representan el x% del total de personas.

Ante esta situacion tomamos la desicion de ...

# Seleccion de Variables

Para predecir la satisfaccion se tomaron en cuenta las evidencias halladas en la bibliografia, donde se encontro que las variables relacionadas con el nivel de satisfaccion de una persona son las siguientes:

* NIVEL_DE_EDUCACION
* SEXO
* SALUD_AUTOPERCIBIDA
* ESTADO_CIVIL
* ETNIA
* INGRESO_AUTOPERCIBIDO
* SEGURIDAD_AUTOPERCIBIDA
* TRABAJO_AUTOPERCIBIDO
* SATISFACCION
* I_HOGAR
* PERCAPITA
* COND_VIDA_DEL_HOGAR



```{r lectura_datos, echo=F}
personas <- read.csv2("Datos/personas.csv", header=TRUE, dec=".", encoding="UTF-8")
salud <- read.csv2("Datos/salud.csv", header=TRUE, dec=".", encoding="UTF-8")
educacion <- read.csv2("Datos/educacion.csv", header=TRUE, dec=".", encoding="UTF-8")
cond_hogar <- read.csv2("Datos/condiciones_hogar.csv", header=TRUE, dec=".", encoding="UTF-8")
datos_vivienda <- read.csv2("Datos/datos_vivienda.csv", header=TRUE, dec=".", encoding="UTF-8")
serv_hogar <- read.csv2("Datos/servicios_hogar.csv", header=TRUE, dec=".", encoding="UTF-8")
fuerza_trabajo <- read.csv2("Datos/fuerza_trabajo.csv", header=TRUE, dec=".", encoding="UTF-8")
comp_hogar <- read.csv2("Datos/caracteristicas_composicion_del_hogar.csv", header=TRUE, dec=".", encoding="UTF-8")
```
El primer paso para verificar si las variables anteriores servirán para ajustar algún modelo es hacer un análisis descriptivo de cada una agrupando los niños y abuelos.

# Modelos Predictivos
Inicialmente, se intentó englobar en un modelo a los abuelos y niños con el fin de predecir la satisfacción. Sin embargo, como lo ilustra la tabla 1, las variables objetivos que se seleccionaron no fueron respondidas, en su mayoría, por niños. Este comportamiento se asemeja con los resultados encontrados en \cite{b7}, donde se puede observar que los abuelos y niños tienen diferentes definiciones de satisfacción y, por ende, diferentes factores que la influyen. Por esta razón, se decidió trabajar de forma independiente los modelos para los niños y abuelos.


## Modelos Predictivos en Abuelos
```{r, echo = FALSE}
library(caret)
df_abuelos <- subset(personas, personas$Clasificación != "niño")
```
### Satisfacción de la Vida en General

#### Análisis Descriptivo

##### Conteo de respuestas

```{r,echo=F}
countedAnswers <- aggregate(. ~ Clasificación, personas, FUN = function(x) sum(!is.na(x)), na.action = NULL)
kable(countedAnswers[,1:8]) %>% 
  kable_styling(position = "center")%>%
  kable_styling(latex_options = "HOLD_position") %>% 
  kable_styling(latex_options="scale_down")
kable(countedAnswers[,9:15]) %>% 
  kable_styling(position = "center")%>%
  kable_styling(latex_options = "HOLD_position") %>% 
  kable_styling(latex_options="scale_down")
```

Según la tabla anterior las variables que preguntan directamente por la satisfacción no son respondidas por los niños, por lo tanto se decide abordar y desarrollar modelos por separado para niños y abuelos.

```{r, echo = FALSE}

# Se descartan las columnas que no hacen parte de la predicción
datos <- subset(personas, select = c(SATISFACCION, SALUD_AUTOPERCIBIDA, SEGURIDAD_AUTOPERCIBIDA, 
                                     NIVEL_DE_EDUCACION, COND_VIDA_DEL_HOGAR, TRABAJO_AUTOPERCIBIDO))


# Por facilidad, se renombran las variables a Xi, 1 <= i <= 11
names(datos) <- c('Y', 'X1','X2', 'X3', 'X4', 'X5')
datos <- na.omit(datos)
```

##### Matriz de Correlaciones

Para empezar la selección de posibles variables objetivo y predictoras de las escogidas anteriormente se desarrolla el siguiente gráfico de correlación:

```{r correlación_satisfacción ,echo=F}
varsGeneral <- personas %>% select(-ID_Persona,-Clasificación,-SEXO) %>% na.omit() 
M = cor(varsGeneral)
ggcorrplot(M, hc.order = TRUE, type = "lower",
   lab = TRUE,tl.cex = 8, pch.col = "red",lab_size = 2)
```
Se evalúa la posibilidad de establecer como posible variable objetivo la satisfacción, esta tiene una buena correlación con las variables de satisfacción pero no con el resto, por lo tanto es posible que no tenga mucho sentido predecir la satisfacción general de un abuelo a partir de todas estas variables. Con base en lo anterior se evalúa la implementación de varios modelos, uno por cada variable de satisfacción.

#### KNN

```{r, echo = FALSE}
# Normalización de los datos
set.seed(27042022) # se fija por reproducibilidad

Y <- datos$Y
X_centrada <- scale(datos,center = TRUE, scale = TRUE)
media_total <- attr(X_centrada,'scaled:center')
desv_est_total <- attr(X_centrada,'scaled:scale')
```

```{r, echo = FALSE}
set.seed(27042022) # se fija por reproducibilidad

# Separación de los datos en entrenamiento y prueba
datos1 <- sample(2, nrow(datos),
                   replace = T,
                    prob = c(0.75, 0.25))

train <- datos[datos1 == 1,]
test <- datos[datos1 == 2,]

# Modelo de KNN con 4-folds
modelo_knn_k4 <- knnreg(x=X_centrada,y=Y,k=4)

test$KNN_Predict <- predict(modelo_knn_k4, newdata = test)
head(test[ , c('Y', 'KNN_Predict')])
```


#### Regresion con lm y glm
```{r, echo=FALSE}
set.seed(27042022) # se fija por reproducibilidad


# Separación de los datos en entrenamiento y prueba
datos1 <- sample(2, nrow(datos),
                   replace = T,
                   prob = c(0.75, 0.25))

train <- datos[datos1 == 1,]
test <- datos[datos1 == 2,]

# Train

lm1 <- lm(formula = Y ~ . , data=train )
summary(lm1)

test$Y_Predict <- predict(lm1, newdata=test)
print(test[ , c('Y', 'Y_Predict')])
```

### Satisfacción en la Salud

Según (PONER BIBLIOGRAFÍA) se seleccionan las siguientes variables como posibles predictores de la satisfacción de la Salud de los abuelos:

* AFILIADO (p6090)
* PAGO_MENSUAL (p8551)
* CALIDAD_PRESTADOR (p6181)
* ESTADO_SALUD (p6127)
* TIPO_PAGO (p6115)

### Satisfacción sobre el Nivel de Seguridad

### Satisfacción en el Trabajo

## Modelos Predictivos en Niños

# Conclusiones

# Recomendaciones

\begin{thebibliography}{X}
\bibitem{b1}
Ramírez Pérez, Mauricio; Lee Maturana, Sau-Lyn (2012). Factores asociados a la satisfacción vital en adultos mayores de 60 años. Polis (Santiago), 11(33), 407–428. doi:10.4067/s0718-65682012000300020
\bibitem{b2}
Kutubaeva RZh (2019) Analysis of life satisfaction of the elderly population on the example of Sweden, Austria and Germany. Population and Economics 3(3): 102-116. https://doi.org/10.3897/popecon.3.e47192
\bibitem{b3}
Palmore, E., Luikart, C. (1972). Health and Social Factors Related to Life Satisfaction. Journal of Health and Social Behavior, 13(1), 68–80. doi: 10.2307/2136974
\bibitem{b4}
Naidu, Aditi (2009). Factors affecting patient satisfaction and healthcare quality. International Journal of Health Care Quality Assurance, 22(4), 366–381. doi:10.1108/09526860910964834 
\bibitem{b5}
ROBLES-GARCIA, Monica et al. Variables relacionadas con la satisfaccion laboral: un estudio transversal a partir del modelo EFQM. Gac Sanit [online]. 2005, vol.19, n.2, pp.127-134. ISSN 0213-9111
\bibitem{b6}
Booth, Jaime; Ayers, Stephanie L.; and Marsiglia, Flavio F. (2012) "Perceived Neighborhood Safety and Psychological Distress: Exploring Protective Factors," The Journal of Sociology \& Social Welfare: Vol. 39 : Iss. 4 , Article 8. Available at: https://scholarworks.wmich.edu/jssw/vol39/iss4/
\bibitem{b7}
https://ourworldindata.org/happiness-and-life-satisfaction
\end{thebibliography}

